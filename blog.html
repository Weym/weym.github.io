<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Sem Frameworks</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; color: #333; }
        img { max-width: 100%; height: auto; border-radius: 5px; }
        blockquote { border-left: 4px solid #ccc; padding-left: 15px; color: #666; font-style: italic; }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; border-radius: 4px; }
        code { font-family: monospace; background: #eee; padding: 2px 4px; border-radius: 3px; }
        .post-link { display: block; margin: 10px 0; padding: 10px; border: 1px solid #ddd; text-decoration: none; color: #333; border-radius: 5px;}
        .post-link:hover { background-color: #f9f9f9; border-color: #aaa; }
        #back-btn { margin-bottom: 20px; display: inline-block; cursor: pointer; color: blue; text-decoration: underline; }
    </style>
</head>
<body>

    <h1 id="site-title">Meu Blog Artesanal</h1>
    
    <div id="back-btn" style="display:none" onclick="goHome()">← Voltar</div>
    
    <div id="content">Carregando...</div>

    <script>
        // CONFIGURAÇÃO
        const USER = 'Weym';
        const REPO = 'projeto-aprendizado';
        const BRANCH = 'main'; 

        // -----------------------------------------------
        //  SEU PARSER DE MARKDOWN (O Coração do Código)
        // -----------------------------------------------
function parseMarkdown(markdownText) {
    let html = markdownText;

    // --- FUNÇÃO AUXILIAR: CRIA SLUGS (ids) ---
    // Transforma "1. Fundamentos e Topologias" em "1-fundamentos-e-topologias"
    // Remove acentos, caracteres especiais e espaços
    function slugify(text) {
        return text
            .toString()
            .toLowerCase()
            .normalize('NFD').replace(/[\u0300-\u036f]/g, "") // Remove acentos
            .trim()
            .replace(/\s+/g, '-')     // Troca espaços por hífens
            .replace(/[^\w\-]+/g, '') // Remove tudo que não for letra, número ou hífen
            .replace(/\-\-+/g, '-');  // Remove hífens duplicados
    }

    // 1. Limpeza e Blocos de Código (Mantém igual)
    html = html.replace(/```([^]+?)```/g, '<pre><code>$1</code></pre>');
    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

    // 2. CABEÇALHOS COM ID AUTOMÁTICO (A Mágica acontece aqui)
    // Agora usamos uma função de callback para gerar o ID baseado no título
    
    // H1
    html = html.replace(/^# (.*$)/gim, (match, title) => {
        return `<h1 id="${slugify(title)}">${title.trim()}</h1>`;
    });
    
    // H2
    html = html.replace(/^## (.*$)/gim, (match, title) => {
        return `<h2 id="${slugify(title)}">${title.trim()}</h2>`;
    });

    // H3
    html = html.replace(/^### (.*$)/gim, (match, title) => {
        return `<h3 id="${slugify(title)}">${title.trim()}</h3>`;
    });

    // 3. IMAGENS (Mantém igual)
    html = html.replace(/!\[(.*?)\]\((.*?)\)/gim, "<img src='$2' alt='$1' />");

    // 4. LINKS INTELIGENTES (Correção do seu problema)
    html = html.replace(/\[(.*?)\]\((.*?)\)/gim, (match, text, url) => {
        // Se a URL começa com #, é um link interno (âncora)
        if (url.startsWith('#')) {
            // Removemos o target='_blank' para ele navegar na mesma página
            return `<a href="${url}">${text}</a>`; 
        } else {
            // Se for link externo, mantém abrindo em nova aba
            return `<a href="${url}" target="_blank">${text}</a>`;
        }
    });

    // 5. ESTILOS BÁSICOS (Mantém igual)
    html = html.replace(/\*\*(.*?)\*\*/gim, '<b>$1</b>');
    html = html.replace(/\*(.*?)\*/gim, '<i>$1</i>');
    html = html.replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>');
    html = html.replace(/^\- (.*$)/gim, '<li>$1</li>');
    html = html.replace(/\n/gim, '<br />');

    return html;
}

        // -----------------------------------------------
        //  LÓGICA DO APP
        // -----------------------------------------------
        const contentDiv = document.getElementById('content');
        const backBtn = document.getElementById('back-btn');

        async function init() {
            const params = new URLSearchParams(window.location.search);
            const postSlug = params.get('post');

            if (postSlug) {
                await loadPost(postSlug);
            } else {
                await loadList();
            }
        }

        async function loadList() {
            backBtn.style.display = 'none';
            contentDiv.innerHTML = 'Carregando lista...';
            
            try {
                const resp = await fetch(`https://raw.githubusercontent.com/${USER}/${REPO}/${BRANCH}/posts.json`);
                const posts = await resp.json();
                
                let listHtml = '';
                posts.forEach(post => {
                    listHtml += `
                        <a href="?post=${post.slug}" class="post-link">
                            <h3>${post.titulo}</h3>
                            <small>${post.data}</small>
                        </a>
                    `;
                });
                contentDiv.innerHTML = listHtml;
            } catch (e) {
                contentDiv.innerHTML = 'Erro ao carregar lista. Verifique o console.';
                console.error(e);
            }
        }

        async function loadPost(slug) {
            backBtn.style.display = 'block';
            contentDiv.innerHTML = 'Carregando post...';

            try {
                // const resp = await fetch(`https://raw.githubusercontent.com/${USER}/${REPO}/${BRANCH}/posts/${slug}.md`);
                const resp = await fetch(`https://raw.githubusercontent.com/${USER}/${REPO}/${BRANCH}/${slug}.md`);
                if (!resp.ok) throw new Error('404');
                const text = await resp.text();
                
                // AQUI USAMOS NOSSA FUNÇÃO ARTESANAL
                const htmlConvertido = parseMarkdown(text);
                
                contentDiv.innerHTML = htmlConvertido;
            } catch (e) {
                contentDiv.innerHTML = 'Erro: Post não encontrado.';
            }
        }

        function goHome() {
            window.location.href = window.location.pathname;
        }

        init();
    </script>
</body>
</html>